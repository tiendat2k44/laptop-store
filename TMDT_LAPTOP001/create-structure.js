#!/usr/bin/env node
const fs = require('fs').promises;
const path = require('path');

const base = 'laptop-store';

const files = [
  // root files
  { p: `${base}/.htaccess`, c: `# Apache config placeholder\n# RewriteEngine On\n` },
  { p: `${base}/index.php`, c: `<?php\n// Entry point\nrequire 'pages/index.php';\n` },
  { p: `${base}/README.md`, c: `# laptop-store\n\nProject skeleton generated by create-structure.js\n` },

  // admin
  { p: `${base}/admin/index.php`, c: `<?php\n// Admin dashboard\n?>\n` },
  { p: `${base}/admin/products.php`, c: `<?php\n// Manage products\n?>\n` },
  { p: `${base}/admin/orders.php`, c: `<?php\n// Manage orders\n?>\n` },
  { p: `${base}/admin/customers.php`, c: `<?php\n// Manage customers\n?>\n` },
  { p: `${base}/admin/financial.php`, c: `<?php\n// Financial management\n?>\n` },
  { p: `${base}/admin/reports.php`, c: `<?php\n// Reports\n?>\n` },
  { p: `${base}/admin/logout.php`, c: `<?php\n// Admin logout\n?>\n` },

  // includes
  { p: `${base}/includes/config.php`, c: `<?php\n// Database config, constants\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'root');\ndefine('DB_PASS', '');\ndefine('DB_NAME', 'laptop_store');\n?>\n` },
  { p: `${base}/includes/database.php`, c: `<?php\n// PDO connection example\nfunction getPDO(){\n  static $pdo = null;\n  if ($pdo === null) {\n    $dsn = 'mysql:host='.DB_HOST.';dbname='.DB_NAME.';charset=utf8mb4';\n    $pdo = new PDO($dsn, DB_USER, DB_PASS, [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]);\n  }\n  return $pdo;\n}\n?>\n` },
  { p: `${base}/includes/auth.php`, c: `<?php\n// Authentication helpers\nfunction isLoggedIn(){\n  return !empty($_SESSION['user_id']);\n}\n?>\n` },
  { p: `${base}/includes/functions.php`, c: `<?php\n// General utility functions\n?>\n` },
  { p: `${base}/includes/cart_functions.php`, c: `<?php\n// Cart related functions\n?>\n` },
  { p: `${base}/includes/payment_functions.php`, c: `<?php\n// Payment helpers (wrap gateways here)\n?>\n` },
  { p: `${base}/includes/header.php`, c: `<?php\n// Common HTML header include\n?>\n` },

  // pages
  { p: `${base}/pages/index.php`, c: `<?php\n// Home page\n?>\n` },
  { p: `${base}/pages/register.php`, c: `<?php\n// Register\n?>\n` },
  { p: `${base}/pages/login.php`, c: `<?php\n// Login\n?>\n` },
  { p: `${base}/pages/profile.php`, c: `<?php\n// Profile\n?>\n` },
  { p: `${base}/pages/products.php`, c: `<?php\n// Product list\n?>\n` },
  { p: `${base}/pages/product-detail.php`, c: `<?php\n// Product detail\n?>\n` },
  { p: `${base}/pages/cart.php`, c: `<?php\n// Cart\n?>\n` },
  { p: `${base}/pages/checkout.php`, c: `<?php\n// Checkout\n?>\n` },
  { p: `${base}/pages/orders.php`, c: `<?php\n// My orders\n?>\n` },
  { p: `${base}/pages/logout.php`, c: `<?php\n// Logout\n?>\n` },

  // assets
  { p: `${base}/assets/css/style.css`, c: `/* Main CSS */\n` },
  { p: `${base}/assets/css/admin.css`, c: `/* Admin CSS */\n` },
  { p: `${base}/assets/css/responsive.css`, c: `/* Responsive rules */\n` },
  { p: `${base}/assets/js/main.js`, c: `// Main JS\n` },
  { p: `${base}/assets/js/cart.js`, c: `// Cart handling\n` },
  { p: `${base}/assets/js/validation.js`, c: `// Form validation\n` },
  { p: `${base}/assets/images/.gitkeep`, c: `` },
  { p: `${base}/assets/images/products/.gitkeep`, c: `` },
  { p: `${base}/assets/images/banners/.gitkeep`, c: `` },
  { p: `${base}/assets/images/icons/.gitkeep`, c: `` },
  { p: `${base}/assets/uploads/.gitkeep`, c: `` },

  // database
  { p: `${base}/database/schema.sql`, c: `-- SQL schema placeholder\n-- CREATE TABLE users (...);\n` },
  { p: `${base}/database/sample_data.sql`, c: `-- sample data\n` },
  { p: `${base}/database/migrations/.gitkeep`, c: `` },

  // libs
  { p: `${base}/libs/phpmailer/.gitkeep`, c: `` },
  { p: `${base}/libs/bootstrap/.gitkeep`, c: `` },

  // logs
  { p: `${base}/logs/error.log`, c: `` },
  { p: `${base}/logs/activity.log`, c: `` },
];

async function ensureDir(filePath) {
  const dir = path.dirname(filePath);
  await fs.mkdir(dir, { recursive: true });
}

async function writeIfNotExists(filePath, content) {
  try {
    await fs.access(filePath);
    // file exists: skip writing to avoid overwriting
    console.log(`exists: ${filePath}`);
  } catch {
    await fs.writeFile(filePath, content, { encoding: 'utf8' });
    console.log(`created: ${filePath}`);
  }
}

(async () => {
  try {
    for (const f of files) {
      await ensureDir(f.p);
      await writeIfNotExists(f.p, f.c);
    }
    // create package.json helper for convenience
    const pkgPath = path.join(base, 'package.json');
    const pkg = {
      name: "laptop-store-skeleton",
      version: "1.0.0",
      description: "Generated skeleton for laptop-store (PHP) by create-structure.js",
      scripts: {
        "create-structure": "node create-structure.js"
      },
      author: "",
      license: "MIT"
    };
    await writeIfNotExists(pkgPath, JSON.stringify(pkg, null, 2));
    console.log('\nAll done. Structure created under:', base);
    console.log('Run `ls -R laptop-store` to inspect files.');
  } catch (err) {
    console.error('Error:', err);
    process.exit(1);
  }
})();